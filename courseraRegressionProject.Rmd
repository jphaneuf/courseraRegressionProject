---
title: "Coursera Regression Project"
author: "Joe Phaneuf"
date: "02/10/2015"
output: pdf_document
---
```{r echo=FALSE,results='hide'}
library(ggplot2)
library(reshape2)
figures<-vector()
getNewFigureNumber <- function(figureVector){
  return(paste0("Fig ",as.character(length(figureVector)+1),". "))
}
```

##Executive Summary
This report uses Motor Trend Magazine data from 1974 to determine if there is a measurable difference in gas mileage (mpg) between manual and automatic transmission cars.  After fitting a linear model to account for vehicle weight, it was found that the mileage difference between manual and automatic transmission vehicles is a function of weight, where manual transmissions are more efficient at lower weights, and automatic transmissions are more efficient at higher weights.  The data was not sufficient to claim a causal effect.

##Exploratory Data Analysis
This dataset contains miles-per-gallon, number of cylinders, engine displacement, rear axle ratio, weight, qsec, V-or-Straight engine, transmission type (*am*), number of forward gears, and number of carburetors.
We'd expect weight to be one of the largest predictors of gas-mileage, so to get our bearings, let's view a plot of gas-mileage against weight, colored by transmission type (0=automatic, 1 = manual)
```{r}
fmpgvwt <- getNewFigureNumber(figures)
figures<-c(figures,list(ggplot(mtcars,aes(x=wt,y=mpg,colour=factor(am)))+
        geom_point()+scale_colour_brewer(palette="Set1")+
        geom_smooth(method="lm",fill=NA)+xlab("weight (x1000lbs)")+
        ggtitle(paste0(fmpgvwt,"MPG vs. Weight, Colored by Transmission Type"))))
```
See `r fmpgvwt` in the appendix.
```

##Model Selection
The simplest possible model for this problem is fitting gas-mileage on transmission type:
```{r results='hide'}
summary(lm(mpg~am,data=mtcars))
```
However, the R^2 for this model is quite low, indicating that transmission type alone is not sufficient to predict gas mileage.  `r fmpgvwt` showed that weight is a very strong predictor for gas mileage, and the varying slopes for transmission type indicate an interaction term:
```{r}
mpgModel <- lm(mpg~wt*am,data=mtcars)
summary(mpgModel)
fresq <- getNewFigureNumber(figures)
figures <- c(figures,list(qplot(sample=residuals(mpgModel),stat="qq",
            main=paste0(fresq,"Qunatile-Quantile Plot of mpgModel Residuals"))))
```

All of the terms in this model are significant (p<0.05), and the R^2 indicates that these terms explain most of the gas-mileage variability.  Introducing other variables in the dataset into this model has little effect on increasing the model fit, so this model will be used for the finaly analysis.  

##Analysis
```{r}
mockCars<- data.frame(wt=0:7)
mockCars$diff<- predict(mpgModel,cbind(mockCars,am=rep(1,8)))-
                  predict(mpgModel,cbind(mockCars,am=rep(0,8)))
fmpgdiff <- getNewFigureNumber(figures)
figures<-c(figures,list(ggplot(mockCars,aes(x=wt,y=diff))+
        geom_line()+scale_colour_brewer(palette="Set1")+
        xlab("weight (x1000lbs)")+
        ggtitle(paste0(fmpgdiff,"Predicted mpg Increase for Manual Transmission vs. Wt"))))
```
For model diagnostics, refer to figure `r fresq` for a quantile-quantile plot of the model's residuals.  The qq plot exhibits some non-linearity, indicating some skew in thew distribution of the residuals.

With 95% confidence, the transmission type variable (am) is significant (p=0.001), as is the transmission:weight interaction term (p=0.001).  The interaction term indicates that the mileage difference due to transmission type is dependant on weight.  Using the model coefficients, we can say that manual tranmission cars get `r coef(mpgModel)[3]` `r coef(mpgModel)[4]`x weight(x1000lbs) higher mpg than automatic transmission cars.  See `r fmpgdiff` for a plot of manual transmission mpg difference as a function of weight.  Note that this line crosses zero, meaning in some conditions automatic transmission yield higher gas mileage.

##Appendix
```{r}
for(f in figures){
  print(f)
  print("")
}
```

